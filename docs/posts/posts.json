[
  {
    "path": "posts/in-cycle-230323/",
    "title": "March 23 2023",
    "description": "In-cycle sampling on Thursday, March 23 2023",
    "author": [],
    "date": "2023-03-23",
    "categories": [
      "in-cycle"
    ],
    "contents": "\r\n\r\nContents\r\nNotebook set up\r\nIn-cycle plot\r\nMaximum rate calculations\r\nP release rate\r\nDenitrification rate & anoxic P uptake\r\nLast updated on\r\n\r\n\r\nOperational changes:\r\nDecreased influent COD (~100 mg/L COD), to achieve an influent COD:N of 10:3.\r\nNotebook set up\r\n\r\n\r\nShow code\r\n\r\noptions(scipen = 0, digits = 2)\r\n\r\n# functions\r\nsource(\"./scripts/cycle_parsing.R\")\r\nsource(\"./scripts/pull_solids.R\")\r\nsource(\"./scripts/plotting.R\")\r\n\r\n# packages\r\nlibrary(MetBrewer)\r\nlibrary(ggplot2)\r\nlibrary(readxl)\r\nlibrary(lubridate)\r\nlibrary(reshape2)\r\nlibrary(dplyr)\r\n\r\n# data\r\nfile_path <- \"C:/Users/mckyf/Northwestern University/Wells Research Group - CANDO+P Reactor/04 Performance data/\"\r\nexcel_cycle <- \"cycle_results_2023.xlsx\"\r\nexcel_solids <- \"daily_weekly_measurements.xlsx\"\r\nchoose_date <- \"2023-03-23\"\r\n\r\ndf <- cycle_parse(file.path(file_path, excel_cycle), choose_date)\r\nsolids <- get_recent_tss(file.path(file_path, excel_solids), choose_date)\r\n\r\n\r\nIn-cycle plot\r\n\r\n\r\nShow code\r\n\r\nylim_custom <- round(max(df$value, na.rm = TRUE) + 10, 0)  # customize after looking at the plot\r\n\r\n# dynamic phase lines\r\nphase_times <- df %>% group_by(phase) %>% summarise(t0 = min(hour))\r\n\r\nphase_lines <- list(\r\n  geom_vline(xintercept = filter(phase_times, phase == \"anx\")$t0, color=\"grey\"),\r\n  geom_vline(xintercept = filter(phase_times, phase == \"aer\")$t0, color=\"grey\"))\r\n\r\n\r\nphase_labs <- list(\r\n  annotate(\"text\", x = mean(phase_times$t0[1:2]), y = ylim_custom, label = \"anaerobic\"),\r\n  annotate(\"text\", x = mean(phase_times$t0[2:3]), y = ylim_custom, label = \"anoxic\"),\r\n  annotate(\"text\", x = mean(c(phase_times$t0[3], max(df$hour))), y = ylim_custom, label = \"aerobic\")\r\n)\r\n\r\n\r\n\r\n\r\nShow code\r\n\r\n# pull colors and shapes\r\nplot_list <- c(\"phosphate\", \"nitrite\", \"propionate\", \"glucose\") # this has to be in order\r\n\r\nplot_palette <- palette_df %>% filter(vars %in% plot_list)\r\n\r\ncustom_color <- scale_color_manual(name=\"Constituent\",\r\n                                   values=plot_palette$colors,\r\n                                   labels=plot_palette$labels)\r\n\r\ncustom_shape <- scale_shape_manual(name=\"Constituent\",\r\n                                   values=plot_palette$shapes,\r\n                                   labels=plot_palette$labels)\r\n\r\n\r\ndf %>% filter(variable %in% plot_list) %>%\r\n  ggplot(data=.,aes(x=hour, y=value, color=variable, shape=variable)) +\r\n  geom_point(size=2.5, alpha = 0.9) +\r\n  custom_color +\r\n  custom_shape +\r\n  phase_lines +\r\n  theme_defaults +\r\n  phase_labs +\r\n  labs(y=\"Concentration\\n[mgP/L, mgN/L, mgCOD/L]\", x=\"Hour\") +\r\n  ylim(0, ylim_custom)\r\n\r\n\r\n\r\nNotes on in-cycle plot:\r\nGreat P release and anoxic uptake with higher nitrite dose\r\nNo re-release of P after denitrification\r\nAlmost complete P uptake in aerobic phase\r\nChanges for next cycle:\r\nShorter anaerobic and aerobic phases - give as much time as possible to anoxic phase\r\nMaximum rate calculations\r\nMaximum removal rates are calculated from the linear parts of the nutrient or carbon profile. Rates are normalized to solids measurements.\r\nP release rate\r\nBased on the in-cycle plot, I will use the first 3 timepoints for this calculation.\r\n\r\n\r\nShow code\r\n\r\nana_df <- df %>%\r\n  filter(hour <= phase_times$t0[2]) %>%\r\n  filter(variable %in% c(\"phosphate\", \"glucose\", \"propionate\"))\r\n  \r\nana_phos_df <- ana_df %>% \r\n  filter(variable == \"phosphate\") %>%\r\n  filter(hour < 0.2)\r\n\r\nlm_ana_phos <- lm(value ~ hour, data = ana_phos_df)\r\n\r\nana_phos_rate <- abs(unname(coef(lm_ana_phos)[\"hour\"]) / filter(solids, sample == \"ml\")$TSS)\r\n\r\n\r\nThe maximum phosphate release rate is 8.64 mgP/gTSS/hour.\r\nDenitrification rate & anoxic P uptake\r\nBased on the in-cycle plot, I will use the first 4 timepoints for this calculation.\r\n\r\n\r\nShow code\r\n\r\n# get anoxic data\r\nanx_df <- df %>% \r\n  filter(hour >= phase_times$t0[2] & hour < 3) %>%\r\n  filter(variable %in% c(\"nitrite\", \"phosphate\"))\r\n\r\nanx_nitrite_df <- anx_df %>% filter(variable == \"nitrite\")\r\nanx_phos_df <- anx_df %>% filter(variable == \"phosphate\")\r\n\r\nlm_anx_nitrite<- lm(value ~ hour, data = anx_nitrite_df)\r\nlm_anx_phos <- lm(value ~ hour, data = anx_phos_df)\r\n\r\n# rates normalized to biomass\r\nanx_denit_rate <- abs(unname(coef(lm_anx_nitrite)[\"hour\"]) / filter(solids, sample == \"ml\")$TSS)\r\nanx_phos_rate <- abs(unname(coef(lm_anx_phos)[\"hour\"]) / filter(solids, sample == \"ml\")$TSS)\r\n\r\n\r\nThe maximum denitrification rate is 4.2 mgN/gTSS/hour.\r\nThe maximum anoxic phosphorus uptake rate is 1.75 mgP/gTSS/hour.\r\n\r\n\r\nShow code\r\n\r\nrates_df <- tibble(rates = c(\"phos_rel\", \"phos_up\", \"nit_denit\"),\r\n                   values = c(ana_phos_rate, anx_phos_rate, anx_denit_rate),\r\n                   date = choose_date)\r\n\r\nsaveRDS(rates_df, file = paste0(\"./data/rates-\", choose_date, \".RDS\"))\r\n\r\n\r\nLast updated on\r\n\r\n\r\nShow code\r\n\r\nprint(today())\r\n\r\n[1] \"2023-03-29\"\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/in-cycle-230323/distill-preview.png",
    "last_modified": "2023-03-29T15:30:54-05:00",
    "input_file": "in-cycle-230323.knit.md"
  },
  {
    "path": "posts/in-cycle-230313/",
    "title": "March 13 2023",
    "description": "In-cycle sampling on Monday, March 13 2023",
    "author": [],
    "date": "2023-03-13",
    "categories": [
      "in-cycle"
    ],
    "contents": "\r\n\r\nContents\r\nNotebook set up\r\nIn-cycle plot\r\nMaximum rate calculations\r\nP release rate\r\nDenitrification rate & anoxic P uptake\r\nLast updated on\r\n\r\n\r\nOperational changes:\r\nNotebook set up\r\n\r\n\r\nShow code\r\n\r\noptions(scipen = 0, digits = 2)\r\n\r\n# functions\r\nsource(\"./scripts/cycle_parsing.R\")\r\nsource(\"./scripts/pull_solids.R\")\r\nsource(\"./scripts/plotting.R\")\r\n\r\n# packages\r\nlibrary(MetBrewer)\r\nlibrary(ggplot2)\r\nlibrary(readxl)\r\nlibrary(lubridate)\r\nlibrary(reshape2)\r\nlibrary(dplyr)\r\n\r\n# data\r\nfile_path <- \"C:/Users/mckyf/Northwestern University/Wells Research Group - CANDO+P Reactor/04 Performance data/\"\r\nexcel_cycle <- \"cycle_results_2023.xlsx\"\r\nexcel_solids <- \"daily_weekly_measurements.xlsx\"\r\n\r\n### choose date ###\r\nchoose_date <- \"2023-03-13\" # change this date\r\n\r\ndf <- cycle_parse(file.path(file_path, excel_cycle), choose_date)\r\nsolids <- get_recent_tss(file.path(file_path, excel_solids), choose_date)\r\n\r\n\r\nIn-cycle plot\r\n\r\n\r\nShow code\r\n\r\nylim_custom <- round(max(df$value, na.rm = TRUE) + 10, 0) # customize after looking at the plot\r\n\r\n# dynamic phase lines\r\nphase_times <- df %>% group_by(phase) %>% summarise(t0 = min(hour))\r\n\r\nphase_lines <- list(\r\n  geom_vline(xintercept = filter(phase_times, phase == \"anx\")$t0, color=\"grey\"),\r\n  geom_vline(xintercept = filter(phase_times, phase == \"aer\")$t0, color=\"grey\"))\r\n\r\n\r\nphase_labs <- list(\r\n  annotate(\"text\", x = mean(phase_times$t0[1:2]), y = ylim_custom, label = \"anaerobic\"),\r\n  annotate(\"text\", x = mean(phase_times$t0[2:3]), y = ylim_custom, label = \"anoxic\"),\r\n  annotate(\"text\", x = mean(c(phase_times$t0[3], max(df$hour))), y = ylim_custom, label = \"aerobic\")\r\n)\r\n\r\n\r\n\r\n\r\nShow code\r\n\r\n# pull colors and shapes\r\nplot_list <- c(\"phosphate\", \"nitrite\", \"propionate\", \"glucose\") # this has to be in order\r\n\r\nplot_palette <- palette_df %>% filter(vars %in% plot_list)\r\n\r\ncustom_color <- scale_color_manual(name=\"Constituent\",\r\n                                   values=plot_palette$colors,\r\n                                   labels=plot_palette$labels)\r\n\r\ncustom_shape <- scale_shape_manual(name=\"Constituent\",\r\n                                   values=plot_palette$shapes,\r\n                                   labels=plot_palette$labels)\r\n\r\n\r\ndf %>% filter(variable %in% plot_list) %>%\r\n  ggplot(data=.,aes(x=hour, y=value, color=variable, shape=variable)) +\r\n  geom_point(size=2.5, alpha = 0.9) +\r\n  custom_color +\r\n  custom_shape +\r\n  phase_lines +\r\n  theme_defaults +\r\n  phase_labs +\r\n  labs(y=\"Concentration\\n[mgP/L, mgN/L, mgCOD/L]\", x=\"Hour\") +\r\n  ylim(0, ylim_custom)\r\n\r\n\r\n\r\nNotes on in-cycle plot:\r\nRapid glucose and propionate uptake\r\nP re-release after nitrite is depleted\r\nMaximum rate calculations\r\nMaximum removal rates are calculated from the linear parts of the nutrient or carbon profile. Rates are normalized to solids measurements.\r\nP release rate\r\nBased on the in-cycle plot, I will use the first 3 timepoints for this calculation.\r\n\r\n\r\nShow code\r\n\r\nana_df <- df %>%\r\n  filter(hour <= phase_times$t0[2]) %>%\r\n  filter(variable %in% c(\"phosphate\", \"glucose\", \"propionate\"))\r\n  \r\nana_phos_df <- ana_df %>% \r\n  filter(variable == \"phosphate\") %>%\r\n  filter(hour < 0.2)\r\n\r\nlm_ana_phos <- lm(value ~ hour, data = ana_phos_df)\r\n\r\nana_phos_rate <- abs(unname(coef(lm_ana_phos)[\"hour\"]) / filter(solids, sample == \"ml\")$TSS)\r\n\r\n\r\nThe maximum phosphate release rate is 32.83 mgP/gTSS/hour.\r\nDenitrification rate & anoxic P uptake\r\nBased on the in-cycle plot, I will use the first 3 timepoints for this calculation.\r\n\r\n\r\nShow code\r\n\r\n# get anoxic data\r\nanx_df <- df %>% \r\n  filter(hour >= phase_times$t0[2] & hour < 2.2) %>%\r\n  filter(variable %in% c(\"nitrite\", \"phosphate\"))\r\n\r\nanx_nitrite_df <- anx_df %>% filter(variable == \"nitrite\")\r\nanx_phos_df <- anx_df %>% filter(variable == \"phosphate\")\r\n\r\nlm_anx_nitrite<- lm(value ~ hour, data = anx_nitrite_df)\r\nlm_anx_phos <- lm(value ~ hour, data = anx_phos_df)\r\n\r\n# rates normalized to biomass\r\nanx_denit_rate <- abs(unname(coef(lm_anx_nitrite)[\"hour\"]) / filter(solids, sample == \"ml\")$TSS)\r\nanx_phos_rate <- abs(unname(coef(lm_anx_phos)[\"hour\"]) / filter(solids, sample == \"ml\")$TSS)\r\n\r\n\r\nThe maximum denitrification rate is 5.67 mgN/gTSS/hour.\r\nThe maximum anoxic phosphorus uptake rate is 3.83 mgP/gTSS/hour.\r\n\r\n\r\nShow code\r\n\r\nrates_df <- tibble(rates = c(\"phos_rel\", \"phos_up\", \"nit_denit\"),\r\n                   values = c(ana_phos_rate, anx_phos_rate, anx_denit_rate),\r\n                   date = choose_date)\r\n\r\nsaveRDS(rates_df, file = paste0(\"./data/rates-\", choose_date, \".RDS\"))\r\n\r\n\r\nLast updated on\r\n\r\n\r\nShow code\r\n\r\nprint(today())\r\n\r\n[1] \"2023-03-29\"\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/in-cycle-230313/distill-preview.png",
    "last_modified": "2023-03-29T15:30:39-05:00",
    "input_file": "in-cycle-230313.knit.md"
  }
]
