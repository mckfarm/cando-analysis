{
  "hash": "90a57b41435e4c993d493123681b10a3",
  "result": {
    "markdown": "---\ntitle: \"March 30 2023 glycogen test\"\ndescription: In-cycle sampling with glycogen test on Thursday, March 30 3023\ncategories:\n  - in-cycle\ndate: 2023-03-30\ndate-modified: last-modified\n    \n---\n\n\nThis week I tested the glycogen extraction and measurement with some in-cycle samples. Samples for glycogen analysis were collected during the anaerobic and anoxic phases of the reactor cycle. A rough draft of the protocol used for the glycogen extraction and measurement can be found [here](https://mckennafarmer.notion.site/Glycogen-testing-d78b170286494ce695053984b7ba05c2). \n\n\n## Notebook set up\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(scipen = 0, digits = 2)\nlibrary(here)\n\n# functions\n# functions\nsource(here(\"scripts\", \"cycle_parsing.R\"))\nsource(here(\"scripts\", \"pull_solids.R\"))\nsource(here(\"scripts\", \"plotting.R\"))\nsource(here(\"scripts\", \"max_rates.R\"))\n\n# packages\nlibrary(MetBrewer)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(lubridate)\nlibrary(reshape2)\nlibrary(dplyr)\n\n# misc.\nbase_path <- \"C:/Users/mckyf/Northwestern University/Wells Research Group - CANDO+P Reactor/04 Performance data/\" \n# data\nfile_path <- \"In-cycle sampling\"\nexcel_cycle <- \"230330_gly_cycletest.xlsx\"\nexcel_solids <- \"daily_weekly_measurements.xlsx\"\nchoose_date <- \"2023-03-30\"\n\ndf <- read_excel(file.path(base_path, file_path, excel_cycle))\nsolids <- get_recent_tss(file.path(base_path, excel_solids), choose_date)\n\n\n# light parsing\ndf <- df %>% \n  mutate(hour = time_length(interval(min(time), time), \"hour\")) %>%\n  select(-c(date, time)) %>%\n  filter(phase %in% c(\"ana\", \"anx\")) %>%\n  melt(id = c(\"hour\", \"phase\"))\n```\n:::\n\n\n\n# In-cycle plots\n\n## Nutrient profile\n\nHere is the phosphorus and nitrite profile over the sampling period. Note that the nitrate concentration was minimal so was excluded from this plot. \n\n\n::: {.cell .preview-image}\n\n```{.r .cell-code}\n## plotting params - phase labels and lines\nylim_custom <- round(max(df$value, na.rm = TRUE) + 10, 0)\n\n# dynamic phase lines\nphase_times <- df %>% group_by(phase) %>% summarise(t0 = min(hour))\n\nphase_lines <- list(\n  geom_vline(xintercept = filter(phase_times, phase == \"anx\")$t0, color=\"grey\"))\n\n\nphase_labs <- list(\n  annotate(\"text\", x = mean(phase_times$t0[1:2]), y = ylim_custom, label = \"anaerobic\"),\n  annotate(\"text\", x = mean(c(phase_times$t0[2], max(df$hour))), y = ylim_custom, label = \"anoxic\")\n)\n\n\n# pull colors and shapes\nplot_list <- c(\"phosphate\", \"nitrite\") # this has to be in order\n\nplot_palette <- palette_df %>% filter(vars %in% plot_list)\n\ncustom_color <- scale_color_manual(name=\"Constituent\",\n                                   values=plot_palette$colors,\n                                   labels=plot_palette$labels)\n\ncustom_shape <- scale_shape_manual(name=\"Constituent\",\n                                   values=plot_palette$shapes,\n                                   labels=plot_palette$labels)\n\n#| classes: preview-image\ndf %>% filter(variable %in% plot_list) %>%\n  ggplot(data=.,aes(x=hour, y=value, color=variable, shape=variable)) +\n  geom_point(size=2.5, alpha = 0.9) +\n  custom_color +\n  custom_shape +\n  phase_lines +\n  theme_defaults +\n  phase_labs +\n  labs(y=\"Concentration\\n[mgP/L or mgN/L]\", x=\"Hour\") +\n  ylim(0, ylim_custom)\n```\n\n::: {.cell-output-display}\n![](in-cycle-230330_files/figure-html/in-cycle plot-1.png){width=672}\n:::\n:::\n\n\n## Carbon profile\n\nThis is the COD profile over the same time period. Glucose was not added to this in=cycle test. Note that the glycogen concentration is reported as **mg glucose as COD/g biomass**. This profile does not follow the expected glycogen profile of PAO and GAO, where glycogen would be depleted in the anaerobic phase and replenished in the anoxic phase. I am going to try the measurement again this coming week with a few adjustments - the protocol I used this week can be found [here](https://mckennafarmer.notion.site/Glycogen-testing-d78b170286494ce695053984b7ba05c2). \n\nAdjustments for Monday, April 3rd: \n\n* Add biomass into the digestion tube to produce a final digestion ratio of 1 mg biomass per 1 mL 0.9 M HCl. My ratio ended up being closer to 0.35 mg biomass per 1 mL 0.9 M HCl, so glycogen may not have been hydrolysed completely in all samples.\n* Take biomass samples from the aerobic phase. I only took samples from the anaerobic and anoxic phases to test the method with fewer samples, so I will add aerobic timepoints to better understand the complete glycogen profile. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_gly <- df %>% filter(variable == \"glucose\")\n\n# calculate mg glycogen/g biomass\ndf_gly$value <- df_gly$value * 3 / (solids$TSS * 0.015 / 0.010)\n\ndf_carbon <- rbind(df_gly, subset(df, variable == \"propionate\"))\n\nylim_custom <- 20 # have to manually mess with this with the dual y axis\n\nphase_labs <- list(\n  annotate(\"text\", x = mean(phase_times$t0[1:2]), y = ylim_custom, label = \"anaerobic\"),\n  annotate(\"text\", x = mean(c(phase_times$t0[2], max(df$hour))), y = ylim_custom, label = \"anoxic\")\n)\n\nplot_list <- c(\"propionate\", \"glucose\")\n\nplot_palette <- palette_df %>% filter(vars %in% plot_list)\n\ncustom_color <- scale_color_manual(name=\"Constituent\",\n                                   values=plot_palette$colors,\n                                   labels=plot_palette$labels)\n\ncustom_shape <- scale_shape_manual(name=\"Constituent\",\n                                   values=plot_palette$shapes,\n                                   labels=plot_palette$labels)\n\n\ndf_carbon %>% filter(variable %in% plot_list) %>%\n    ggplot(data=., aes(x=hour, y=value, color = variable, shape = variable)) +\n    geom_point(size=2.5) +\n    phase_lines +\n    phase_labs + \n    custom_color + \n    custom_shape + \n    theme_defaults +\n    labs(y=\"COD concentration\\n[mgCOD/L or mgCOD/gBiomass]\", x=\"Hour\")\n```\n\n::: {.cell-output-display}\n![](in-cycle-230330_files/figure-html/glycogen plot-1.png){width=672}\n:::\n:::\n\n\n\n# Maximum rate calculations\nMaximum removal rates are calculated from the linear parts of the nutrient or carbon profile. Rates are normalized to solids measurements. \n\n\n## P release rate\nBased on the in-cycle plot, I will use the first 3 timepoints for this calculation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nana_phos_rate <- get_max_rate(df, \"ana\", \"phosphate\", 3, solids)\n```\n:::\n\n\nThe maximum phosphate release rate is **10.84 mgP/gTSS/hour**. \n\n## Denitrification rate & anoxic P uptake\nBased on the in-cycle plot, I will use the first 4 timepoints for this calculation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanx_denit_rate <- get_max_rate(df, \"anx\", \"nitrite\", 4, solids)\nanx_phos_rate <- get_max_rate(df, \"anx\", \"phosphate\", 4, solids)\n```\n:::\n\n\n\nThe maximum denitrification rate is **3.22 mgN/gTSS/hour**.  \nThe maximum anoxic phosphorus uptake rate is **1.96 mgP/gTSS/hour**.  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df <- tibble(rates = c(\"phos_rel\", \"phos_up\", \"nit_denit\"),\n                   values = c(ana_phos_rate, anx_phos_rate, anx_denit_rate),\n                   date = choose_date)\n\nsaveRDS(rates_df, file = here(\"data\", paste0(\"rates-\", choose_date, \".RDS\")))\n```\n:::\n\n\n\n## Last updated on {.appendix}\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2023-04-03\"\n```\n:::\n:::",
    "supporting": [
      "in-cycle-230330_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}