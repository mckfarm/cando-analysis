{
  "hash": "8c29f7b0bf904cc86e8e05e659d09e74",
  "result": {
    "markdown": "---\ntitle: \"March 13 2023\"\ndescription: In-cycle sampling on Monday, March 13 2023\ncategories:\n  - in-cycle\ndate: 2023-03-13\ndate-modified: last-modified\nimage: \"230313_files/figure-html/in-cycle plot-1.png\"\n    \n---\n\n\n\nOperational changes:\n\n\n## Notebook set up\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(scipen = 0, digits = 2)\nlibrary(here)\n\n# functions\nsource(here(\"scripts\", \"cycle_parsing.R\"))\nsource(here(\"scripts\", \"pull_solids.R\"))\nsource(here(\"scripts\", \"plotting.R\"))\nsource(here(\"scripts\", \"max_rates.R\"))\n\n# packages\nlibrary(MetBrewer)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(lubridate)\nlibrary(reshape2)\nlibrary(dplyr)\n\n# data\nfile_path <- \"C:/Users/mckyf/Northwestern University/Wells Research Group - CANDO+P Reactor/04 Performance data/\"\nexcel_cycle <- \"cycle_results_2023.xlsx\"\nexcel_solids <- \"daily_weekly_measurements.xlsx\"\n\n### choose date ###\nchoose_date <- \"2023-03-13\" # change this date\n\ndf <- cycle_parse(file.path(file_path, excel_cycle), choose_date)\nsolids <- get_recent_tss(file.path(file_path, excel_solids), choose_date)\n```\n:::\n\n\n\n# In-cycle plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nylim_custom <- round(max(df$value, na.rm = TRUE) + 10, 0) # customize after looking at the plot\n\n# dynamic phase lines\nphase_times <- df %>% group_by(phase) %>% summarise(t0 = min(hour))\n\nphase_lines <- list(\n  geom_vline(xintercept = filter(phase_times, phase == \"anx\")$t0, color=\"grey\"),\n  geom_vline(xintercept = filter(phase_times, phase == \"aer\")$t0, color=\"grey\"))\n\n\nphase_labs <- list(\n  annotate(\"text\", x = mean(phase_times$t0[1:2]), y = ylim_custom, label = \"anaerobic\"),\n  annotate(\"text\", x = mean(phase_times$t0[2:3]), y = ylim_custom, label = \"anoxic\"),\n  annotate(\"text\", x = mean(c(phase_times$t0[3], max(df$hour))), y = ylim_custom, label = \"aerobic\")\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# pull colors and shapes\nplot_list <- c(\"phosphate\", \"nitrite\", \"propionate\", \"glucose\") # this has to be in order\n\nplot_palette <- palette_df %>% filter(vars %in% plot_list)\n\ncustom_color <- scale_color_manual(name=\"Constituent\",\n                                   values=plot_palette$colors,\n                                   labels=plot_palette$labels)\n\ncustom_shape <- scale_shape_manual(name=\"Constituent\",\n                                   values=plot_palette$shapes,\n                                   labels=plot_palette$labels)\n\n\ndf %>% filter(variable %in% plot_list) %>%\n  ggplot(data=.,aes(x=hour, y=value, color=variable, shape=variable)) +\n  geom_point(size=2.5, alpha = 0.9) +\n  custom_color +\n  custom_shape +\n  phase_lines +\n  theme_defaults +\n  phase_labs +\n  labs(y=\"Concentration\\n[mgP/L, mgN/L, mgCOD/L]\", x=\"Hour\") +\n  ylim(0, ylim_custom)\n```\n\n::: {.cell-output-display}\n![](230313_files/figure-html/in-cycle plot-1.png){width=672}\n:::\n:::\n\n\nNotes on in-cycle plot:\n\n* Rapid glucose and propionate uptake\n* P re-release after nitrite is depleted\n\n\n# Maximum removal rates\n\nMaximum removal rates are calculated from the linear parts of the nutrient or carbon profile. Rates are normalized to solids measurements. \n\n## Denitrification rate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanx_denit_rate <- get_max_rate(df, \"anx\", \"nitrite\", 3, solids)\n```\n:::\n\n\nThe maximum denitrification rate is **5.67 mgN/gTSS/hour**. \n\n\n## P release and uptake rates\n\n::: {.cell}\n\n```{.r .cell-code}\nana_phos_rate <- get_max_rate(df, \"ana\", \"phosphate\", 3, solids)\nanx_phos_rate <- get_max_rate(df, \"anx\", \"phosphate\", 3, solids)\naer_phos_rate <- get_max_rate_custom_range(df, \"aer\", \"phosphate\", 2, 4, solids)\n```\n:::\n\n\nThe maximum phosphate release rate is **32.83 mgP/gTSS/hour**.   \nThe maximum anoxic phosphorus uptake rate is **3.83 mgP/gTSS/hour**.  \nThe maximum aerobic phosphorus uptake rate is **4.96 mgP/gTSS/hour**.  \n\n\n## Carbon uptake rates\n\n::: {.cell}\n\n```{.r .cell-code}\nana_prop_rate <- get_max_rate(df, \"ana\", \"propionate\", 5, solids)\nana_glu_rate <- get_max_rate(df, \"ana\", \"glucose\", 4, solids)\n```\n:::\n\n\nThe maximum propionate uptake rate is **28.47 mgCOD/gTSS/hour**.\nThe maximum glucose uptake rate is **30.78 mgCOD/gTSS/hour**.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrates_df <- tibble(rate = c(\"ana_phos\", \"anx_phos\", \"aer_phos\", \"anx_denit\", \"ana_prop\", \"ana_glu\"),\n                   value = c(ana_phos_rate, anx_phos_rate, aer_phos_rate, anx_denit_rate, ana_prop_rate, ana_glu_rate),\n                   )\n\n# also save some important info - starting COD, N, P\nrates_df <- append_rates_df(rates_df, df, choose_date)\n\nsaveRDS(rates_df, file = here(\"data\", paste0(\"rates-\", choose_date, \".RDS\")))\n```\n:::\n",
    "supporting": [
      "230313_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}